<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sign Up — VietConnect</title>
    <link
      rel="icon"
      type="image/png"
      href="{{ url_for('static', filename='images/logo.png') }}"
    />

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --navbar-color: white;
        --primary-color: #00b37e;
        --dark-blue: #0d2c54;
        --text-light: #555;
        --bg-light: #f4f8f7;
        --brand: #00b37e;
        --brand-600: #009966;
        --muted: #6b7280;
        --bg: #fbfdff;
        --card: #ffffff;
        --radius: 12px;
        --glass: rgba(255, 255, 255, 0.6);
        --shadow: 0 6px 20px rgba(13, 17, 23, 0.08);
        --navbar-color: white;
        --max-width: 1100px;
      }

      [data-theme="dark"] {
        --navbar-color: #0b0e12;
        --brand: #00d58a;
        --muted: #9aa1a8;
        --bg: #0b0e12;
        --card: #071023;
        --glass: rgba(255, 255, 255, 0.03);
        --shadow: 0 8px 30px rgba(2, 6, 23, 0.6);
      }

      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
        margin: 0;
        font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto,
          "Helvetica Neue", Arial;
        color: var(--dark-blue);
        background: var(--bg);
      }

      .site-wrap {
        max-width: var(--max-width);
        margin: 36px auto;
        padding: 20px;
      }

      header.nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 18px;
        background: var(--navbar-color);
        border-radius: 14px;
        box-shadow: var(--shadow);
      }
      .logo {
        display: flex;
        gap: 12px;
        align-items: center;
      }
      .logo img {
        width: 44px;
        height: 44px;
        border-radius: 8px;
      }
      .logo .brand {
        font-weight: 700;
        font-size: 18px;
      }

      .card {
        background: var(--card);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        overflow: hidden;
      }

      .grid {
        display: grid;
        grid-template-columns: 1fr 460px;
        gap: 28px;
        align-items: center;
      }
      @media (max-width: 980px) {
        .grid {
          grid-template-columns: 1fr;
        }
        .intro-graphic {
          order: 2;
        }
      }

      /* left column */
      .left {
        padding: 36px;
      }
      .kicker {
        display: inline-block;
        background: rgba(0, 0, 0, 0.04);
        padding: 6px 12px;
        border-radius: 999px;
        font-weight: 600;
        margin-bottom: 18px;
      }
      h1 {
        font-size: 28px;
        line-height: 1.05;
        margin: 0 0 14px;
      }
      p.lead {
        color: var(--muted);
        margin: 0 0 22px;
      }

      .features {
        display: flex;
        gap: 10px;
        margin-top: 18px;
      }
      .pill {
        background: var(--glass);
        padding: 10px;
        border-radius: 10px;
        font-weight: 600;
      }

      /* right column (form) */
      .right {
        padding: 28px;
      }
      form {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      label {
        font-size: 14px;
        font-weight: 600;
      }
      .field {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      input[type="text"],
      input[type="email"],
      input[type="password"],
      select {
        padding: 12px 14px;
        border-radius: 12px;
        border: 1px solid rgba(11, 18, 32, 0.06);
        background: transparent;
        font-size: 14px;
        outline: none;
      }
      input:focus {
        box-shadow: 0 6px 20px rgba(0, 179, 126, 0.08);
        border-color: var(--brand);
      }

      .row {
        display: flex;
        gap: 12px;
      }
      .row > * {
        flex: 1;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 16px;
        border-radius: 999px;
        border: none;
        cursor: pointer;
        font-weight: 700;
      }
      .btn.primary {
        background: var(--brand);
        color: white;
      }
      .btn.ghost {
        background: transparent;
        border: 1px solid rgba(11, 18, 32, 0.06);
      }

      .muted {
        color: var(--muted);
        font-size: 13px;
      }
      .terms {
        display: flex;
        gap: 12px;
        align-items: center;
      }

      .socials {
        display: flex;
        gap: 10px;
        margin: 6px 0;
      }
      .socials button {
        flex: 1;
        padding: 10px;
        border-radius: 10px;
        border: 1px solid rgba(11, 18, 32, 0.06);
        background: transparent;
        cursor: pointer;
      }

      .divider {
        display: flex;
        align-items: center;
        gap: 12px;
        color: var(--muted);
        font-size: 13px;
      }
      .divider:before,
      .divider:after {
        content: "";
        flex: 1;
        height: 1px;
        background: rgba(11, 18, 32, 0.04);
        border-radius: 2px;
      }

      .note {
        font-size: 13px;
        color: var(--muted);
      }

      .error {
        color: #e23a3a;
        font-size: 13px;
      }
      .success {
        color: #0b8f5a;
        font-weight: 700;
      }

      .pw-meter {
        height: 8px;
        border-radius: 999px;
        background: rgba(11, 18, 32, 0.06);
        overflow: hidden;
      }
      .pw-meter > span {
        display: block;
        height: 100%;
        width: 0%;
        transition: width 220ms ease;
      }

      footer.page-foot {
        margin-top: 18px;
        padding: 20px;
        border-radius: 12px;
        background: transparent;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      /* small helpers */
      .text-right {
        text-align: right;
      }
    </style>
  </head>
  <body>
    <div class="site-wrap">
      <header class="nav">
        <div class="logo">
          <img
            src="{{ url_for('static', filename='images/logo.png') }}"
            alt="VietConnect logo"
          />
          <div>
            <div class="brand">VietConnect</div>
            <div class="muted" style="font-size: 12px">
              Ho Chi Minh City • Multilingual
            </div>
          </div>
        </div>
        <nav style="display: flex; gap: 12px; align-items: center">
          <a href="{{url_for('home_page')}}" class="muted">Home</a>
          <a href="{{url_for('auth.signin_page')}}" class="muted">Sign In</a>
        </nav>
      </header>

      <main style="margin-top: 20px" class="card grid">
        <section class="left">
          <div class="kicker">Create an account</div>
          <h1>
            Welcome to VietConnect — Support for foreigners in Ho Chi Minh City
          </h1>
          <p class="lead">
            Secure account to access multilingual assistance, medical and safety
            services, and step-by-step administrative help.
          </p>

          <div class="features">
            <div class="pill">Emergency-ready</div>
            <div class="pill">Multilingual</div>
            <div class="pill">Privacy-first</div>
          </div>

          <div style="margin-top: 22px">
            <h3 style="margin: 0 0 8px">Why sign up?</h3>
            <ul style="margin: 0; padding-left: 18px; color: var(--muted)">
              <li>Fast AI triage and direct agent handoff</li>
              <li>Saved documents and templates for administrative tasks</li>
              <li>Encrypted personal data and consent controls</li>
            </ul>
          </div>

          <div style="margin-top: 20px; color: var(--muted); font-size: 13px">
            Already have an account?
            <a href="{{url_for('auth.signin_page')}}">Sign in</a>
          </div>
        </section>

        <aside class="right">
          <form
            id="signupForm"
            novalidate
            action="{{ url_for('auth.signup_page') }}"
            method="POST"
          >
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 6px;
              "
            >
              <h2 style="margin: 0">Sign up</h2>
              <small class="muted">It takes less than a minute</small>
            </div>
            <div class="row">
              <div class="field">
                <label for="phone">Phone (optional)</label>
                <input
                  id="phone"
                  name="phone"
                  type="text"
                  placeholder="+84 9xx xxx xxx"
                  value="{{ form_data.phone or '' }}"
                />
              </div>
              <div class="field">
                <label for="lang">Preferred language</label>
                <select id="lang" name="lang">
                  <option value="en" {% if form_data.lang == 'en' %}selected{% endif %}>
                    English
                  </option>
                  <option value="vi" {% if form_data.lang == 'vi' %}selected{% endif %}>
                    Tiếng Việt
                  </option>
                  <option value="zh" {% if form_data.lang == 'zh' %}selected{% endif %}>
                    中文
                  </option>
                  <option value="ja" {% if form_data.lang == 'ja' %}selected{% endif %}>
                    日本語
                  </option>
                </select>
              </div>
            </div>

            <div class="field">
              <label for="password">Password</label>
              <div style="position: relative">
                <input
                  id="password"
                  name="password"
                  type="password"
                  placeholder="Create a strong password"
                  required
                />
                <button
                  type="button"
                  id="togglePw"
                  title="Show / Hide password"
                  style="
                    position: absolute;
                    right: 8px;
                    top: 8px;
                    border: none;
                    background: transparent;
                    cursor: pointer;
                  "
                >
                  Show
                </button>
              </div>
              <div class="pw-meter" aria-hidden="true">
                <span
                  id="pwBar"
                  style="
                    background: linear-gradient(
                      90deg,
                      var(--brand),
                      var(--brand-600)
                    );
                    width: 0%;
                  "
                ></span>
              </div>
              <div class="note" id="pwNote">
                Use at least 8 characters including a number and a symbol.
              </div>
              <div class="error" id="err-pw" aria-live="polite">
                {{ errors.password or '' }}
              </div>
            </div>

            <div class="field">
              <label for="confirm">Confirm password</label>
              <input
                id="confirm"
                name="confirm"
                type="password"
                placeholder="Repeat password"
                required
              />
              <div class="error" id="err-confirm" aria-live="polite">
                {{ errors.confirm or '' }}
              </div>
            </div>

            <div class="terms">
              <input id="agree" type="checkbox" />
              <label for="agree" class="muted"
                >I agree to the <a href="#">Terms of Service</a> and
                <a href="#">Privacy Policy</a>.</label
              >
            </div>
            <div class="error" id="err-terms">
                {{ errors.terms or '' }}
            </div>

            <button class="btn primary" type="submit">Create account</button>

            <div class="divider" style="margin-top: 8px">OR</div>

            <div class="socials">
              <a href="{{ url_for('auth.google_login') }}" class="oauth-btn">
                <img
                  src="https://www.svgrepo.com/show/475656/google-color.svg"
                  width="18"
                />
                Continue with Google
              </a>
            </div>

            <div class="note">
              By creating an account, you consent to receive important service messages.
              Your personal data is protected and shared only with your consent.
            </div>
          </form>
        </aside>
      </main>

      <footer class="page-foot">
        <div class="muted">© 2025 VietConnect</div>
        <div class="text-right muted">
          Need help? <a href="support.html">Contact support</a>
        </div>
      </footer>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // --- 1. Khai báo các biến DOM cần thiết ---
        const form = document.getElementById("signupForm");
        // Giữ lại các trường có trong form
        const password = document.getElementById("password");
        const confirm = document.getElementById("confirm");
        const agree = document.getElementById("agree");

        // Các khu vực hiển thị lỗi
        const errPw = document.getElementById("err-pw");
        const errConfirm = document.getElementById("err-confirm");
        const errTerms = document.getElementById("err-terms");

        // Các thành phần phụ
        const pwBar = document.getElementById("pwBar");
        const pwNote = document.getElementById("pwNote");
        const togglePw = document.getElementById("togglePw");

        // --- 2. Hàm kiểm tra độ mạnh mật khẩu ---
        function scorePassword(p) {
          let score = 0;
          if (p.length >= 8) score += 1;
          if (/[A-Z]/.test(p)) score += 1;
          if (/[0-9]/.test(p)) score += 1;
          if (/[^A-Za-z0-9]/.test(p)) score += 1;
          return score;
        }

        // --- 3. Xử lý hiển thị độ mạnh mật khẩu (Password Meter) ---
        password.addEventListener("input", () => {
          const s = scorePassword(password.value);
          const percent = (s / 4) * 100;
          pwBar.style.width = percent + "%";
          if (s <= 1)
            pwNote.textContent =
              "Yếu — thử mật khẩu dài hơn với số và ký hiệu.";
          else if (s == 2)
            pwNote.textContent = "Trung bình — thêm chữ hoa hoặc ký hiệu.";
          else if (s == 3) pwNote.textContent = "Tốt — gần đạt yêu cầu.";
          else pwNote.textContent = "Mật khẩu mạnh.";
        });

        // --- 4. Xử lý nút Show/Hide mật khẩu ---
        togglePw.addEventListener("click", () => {
          const t = password.type === "password" ? "text" : "password";
          password.type = t;
          confirm.type = t;
          togglePw.textContent = t === "text" ? "Hide" : "Show";
        });

        // --- 5. Xử lý sự kiện Gửi Form (Submit) ---
        form.addEventListener("submit", (e) => {
          // **NGĂN HÀNH VI GỬI FORM MẶC ĐỊNH** để thực hiện xác thực
          e.preventDefault();

          let ok = true;
          // Xóa lỗi cũ
          errPw.textContent = "";
          errConfirm.textContent = "";
          errTerms.textContent = "";

          // ⚠️ LƯU Ý QUAN TRỌNG: Đã bỏ kiểm tra 'email' và 'fullname'

          // Kiểm tra Độ mạnh Mật khẩu
          if (scorePassword(password.value) < 2) {
            errPw.textContent =
              "Vui lòng chọn mật khẩu mạnh hơn (tối thiểu 8 ký tự, bao gồm số và ký hiệu).";
            ok = false;
          }

          // Kiểm tra Khớp Mật khẩu
          if (password.value !== confirm.value) {
            errConfirm.textContent = "Mật khẩu không khớp.";
            ok = false;
          }

          // Kiểm tra Đồng ý Điều khoản (sau khi đã thêm name="agree" và required vào HTML)
          if (!agree.checked) {
            errTerms.textContent = "Bạn phải đồng ý với điều khoản.";
            ok = false;
          }

          if (!ok) return; // Nếu có lỗi, dừng lại và không gửi form

          // **QUAN TRỌNG:** Nếu mọi thứ OK, THỰC HIỆN GỬI FORM LÊN BACKEND
          // Form sẽ gửi các giá trị của các input có thuộc tính "name" (phone, lang, password, confirm, agree)
          form.submit();
        });
      });
    </script>
  </body>
</html>
